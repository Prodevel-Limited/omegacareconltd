---
interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<form 
  id="contact-form" 
  action="https://formspree.io/f/mrepzdlq"
  method="POST"
  class={`space-y-6 ${className}`}
>
  <!-- Name Field -->
  <div>
    <label for="name" class="block text-sm font-semibold text-brand-dark mb-2">
      Full Name <span class="text-brand-burgundy">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-burgundy focus:border-transparent transition-all"
      placeholder="John Smith"
    />
    <span class="error-message text-brand-burgundy text-sm mt-1 hidden"></span>
  </div>

  <!-- Email Field -->
  <div>
    <label for="email" class="block text-sm font-semibold text-brand-dark mb-2">
      Email Address <span class="text-brand-burgundy">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-burgundy focus:border-transparent transition-all"
      placeholder="john.smith@example.com"
    />
    <span class="error-message text-brand-burgundy text-sm mt-1 hidden"></span>
  </div>

  <!-- Phone Field -->
  <div>
    <label for="phone" class="block text-sm font-semibold text-brand-dark mb-2">
      Phone Number <span class="text-brand-burgundy">*</span>
    </label>
    <input
      type="tel"
      id="phone"
      name="phone"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-burgundy focus:border-transparent transition-all"
      placeholder="+44 20 1234 5678"
    />
    <span class="error-message text-brand-burgundy text-sm mt-1 hidden"></span>
  </div>

  <!-- Service Interest (Optional) -->
  <div>
    <label for="service" class="block text-sm font-semibold text-brand-dark mb-2">
      Service Interest
    </label>
    <select
      id="service"
      name="service"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-burgundy focus:border-transparent transition-all"
    >
      <option value="">Select a service...</option>
      <option value="residential">Residential Care Homes</option>
      <option value="hospital">Hospital Staffing</option>
      <option value="specialized">Specialized Care</option>
      <option value="other">Other</option>
    </select>
  </div>

  <!-- Message Field -->
  <div>
    <label for="message" class="block text-sm font-semibold text-brand-dark mb-2">
      Message <span class="text-brand-burgundy">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      required
      rows="5"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-burgundy focus:border-transparent transition-all resize-none"
      placeholder="Tell us about your requirements..."
    ></textarea>
    <span class="error-message text-brand-burgundy text-sm mt-1 hidden"></span>
  </div>

  <!-- Submit Button -->
  <button
    type="submit"
    class="w-full px-8 py-4 bg-brand-burgundy text-white font-semibold rounded-lg hover:bg-opacity-90 shadow-md hover:shadow-lg transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-burgundy disabled:opacity-50 disabled:cursor-not-allowed"
  >
    <span class="submit-text">Send Message</span>
    <span class="loading-text hidden">Sending...</span>
  </button>

  <!-- Success Message -->
  <div id="success-message" class="hidden p-4 bg-green-50 border border-green-200 rounded-lg">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
      <p class="text-green-800 font-medium">Thank you! Your message has been sent successfully.</p>
    </div>
  </div>

  <!-- Error Message -->
  <div id="error-message" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
      </svg>
      <p class="text-red-800 font-medium">Sorry, there was an error sending your message. Please try again or contact us directly.</p>
    </div>
  </div>
</form>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const successMessage = document.getElementById('success-message');
  const errorMessage = document.getElementById('error-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
    const submitText = submitButton.querySelector('.submit-text') as HTMLElement;
    const loadingText = submitButton.querySelector('.loading-text') as HTMLElement;

    // Hide any previous messages
    successMessage?.classList.add('hidden');
    errorMessage?.classList.add('hidden');

    // Show loading state
    submitButton.disabled = true;
    submitText.classList.add('hidden');
    loadingText.classList.remove('hidden');

    // Prepare form data
    const formData = new FormData(form);

    try {
      // Submit to Formspree
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      });

      if (response.ok) {
        // Show success message
        successMessage?.classList.remove('hidden');
        form.reset();

        // Scroll to success message
        successMessage?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

        // Hide success message after 5 seconds
        setTimeout(() => {
          successMessage?.classList.add('hidden');
        }, 5000);
      } else {
        // Handle Formspree errors
        const data = await response.json();
        if (data.errors) {
          console.error('Formspree errors:', data.errors);
        }
        throw new Error('Form submission failed');
      }
    } catch (error) {
      // Show error message
      errorMessage?.classList.remove('hidden');
      errorMessage?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      console.error('Form submission error:', error);
    } finally {
      // Reset button state
      submitButton.disabled = false;
      submitText.classList.remove('hidden');
      loadingText.classList.add('hidden');
    }
  });

  // Real-time validation
  const inputs = form?.querySelectorAll('input[required], textarea[required]');
  inputs?.forEach(input => {
    input.addEventListener('blur', () => {
      const inputElement = input as HTMLInputElement | HTMLTextAreaElement;
      const errorSpan = inputElement.parentElement?.querySelector('.error-message');
      
      if (!inputElement.validity.valid) {
        inputElement.classList.add('border-red-500');
        if (errorSpan) {
          errorSpan.textContent = inputElement.validationMessage;
          errorSpan.classList.remove('hidden');
        }
      } else {
        inputElement.classList.remove('border-red-500');
        if (errorSpan) {
          errorSpan.classList.add('hidden');
        }
      }
    });
  });
</script>
